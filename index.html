<html>
<head>
    <style type="text/css">
        div.frame {
            width: 100%;
            height: auto;
            text-align: center;
        }
        div.input {
            float: left;
            width: 50%;
            margin: auto;
        }
        div.output {
            float: left;
            color: blue;
            width: 50%;
            margin: auto;
        }
        textarea {
            resize: vertical;
            width: 50%;
            height: 300px;
        }
    </style>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/js-yaml/3.4.2/js-yaml.min.js'></script>
    <script>
        var isColumn = false;
        $(document).ready(function(){
            $('#input textarea').each(function(){
                $(this).bind('keyup', convert(this));
            });
            function convert(elm){
                var v, old = elm.value;
                return function(){
                    if(old != (v=elm.value)){
                        old = v;
                        str = $(this).val();
                        var doc = jsyaml.load(str);
                        var text = "";
                        var column_name = "";
                        var primary_keys = [];
                        JSON.stringify(doc, function(key, value) {
                            switch (key) {
                                case "type":
                                    text += " " + value;
                                    break;
                                case "primary":
                                    primary_keys.splice(value['seq'] - 1, 0, "`" + column_name + "`");
                                    break;
                                case "not_null":
                                    if (value) text += " NOT NULL";
                                    break;
                                case "auto_increment":
                                    text += " AUTO_INCREMENT";
                                    break;
                                case "default":
                                    text += " DEFAULT " + value;
                                    break;
                                case "comment":
                                    text += " /* " + value + " */";
                                    break;
                                default: // テーブル名 or カラム名
                                    if ( key === 'schema') {
                                        isColumn = true;
                                    } else if (isColumn) {
                                        if (text.slice(-1) !== '(') {
                                            text += ",";
                                        }
                                        text += "`" + key + "`";
                                        column_name = key;
                                    } else {
                                        if (key) {
                                            text += "﻿CREATE TABLE `" + key + "` (";
                                        }
                                    }
                                    return value;
                            }
                        });
                        // 主キー定義
                        text += ",PRIMARY KEY (" + primary_keys.join(',') + ")";
                        text += ");";
                        $("#output div").text(text);
                    }
                }
            }
        });
    </script>
</head>

<body>
<div class="frame">
    <div class="input">
        <div id="input">
            <textarea></textarea></p>
        </div>
    </div>
    <div class="output">
        <div id="output">
            <div></div>
        </div>
    </div>
</div>

</body>
</html>